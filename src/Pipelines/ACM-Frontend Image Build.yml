pool:
  name: Hosted Ubuntu 1604
steps:
- task: DownloadBuildArtifacts@0
  displayName: 'Download Portal Build Artifacts'
  inputs:
    buildType: specific
    project: '6b66ec3e-9200-4ddf-9c78-1ee1d55592f6'
    pipeline: 11
    specificBuildWithTriggering: true
    artifactName: dist
    downloadPath: '$(System.DefaultWorkingDirectory)/src/portal/'

- task: Docker@1
  displayName: 'Build frontend image'
  inputs:
    azureSubscriptionEndpoint: 'BigCompS-Int2 (01b6a57a-5aef-40e2-8af7-562a2f81462e)'
    azureContainerRegistry: hpcacmbuild.azurecr.io
    dockerFile: 'src/Docker/Dockerfile-frontend'
    imageName: 'public/hpcpack/hpcacm/frontend:$(Build.BuildId)'
    includeLatestTag: true
    useDefaultContext: false
    buildContext: src

- task: Docker@1
  displayName: 'Push frontend image'
  inputs:
    azureSubscriptionEndpoint: 'BigCompS-Int2 (01b6a57a-5aef-40e2-8af7-562a2f81462e)'
    azureContainerRegistry: hpcacmbuild.azurecr.io
    command: 'Push an image'
    imageName: 'public/hpcpack/hpcacm/frontend:$(Build.BuildId)'

- task: Docker@1
  displayName: 'Push frontend image with latest tag'
  inputs:
    azureSubscriptionEndpoint: 'BigCompS-Int2 (01b6a57a-5aef-40e2-8af7-562a2f81462e)'
    azureContainerRegistry: hpcacmbuild.azurecr.io
    command: 'Push an image'
    imageName: 'public/hpcpack/hpcacm/frontend:latest'
