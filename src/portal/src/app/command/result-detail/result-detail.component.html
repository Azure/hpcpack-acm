<div class="title" [ngClass]="result?.state">
  <div class="command">{{result?.command}}</div>
  <div class="state">{{result?.state | titlecase }}</div>
</div>

<ng-container *ngIf="isLoaded; else waiting">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-3 selection">
        <mat-form-field>
          <mat-select placeholder="State" [(ngModel)]="state" (change)="filter()">
            <mat-option *ngFor="let opt of states" [value]="opt">
              {{ opt | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field>
          <input matInput placeholder="Name" [(ngModel)]="name" (keyup)="filter()">
        </mat-form-field>
        <mat-table #table [dataSource]="dataSource">
          <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef> Node </mat-header-cell>
            <mat-cell *matCellDef="let node">{{node.name}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="state">
            <mat-header-cell *matHeaderCellDef> State </mat-header-cell>
            <mat-cell *matCellDef="let node">{{node.state | titlecase }}</mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let node; columns: displayedColumns;" [ngClass]="{ selected: isSelected(node) }" (click)="selectNode(node)"></mat-row>
        </mat-table>
      </div>

      <div class="col-md-9 output">
        <div class="control static up" *ngIf="currentOutput?.start === 0; else prevButton">
          Output Begin
        </div>
        <ng-template #prevButton>
          <button class="control up" [ngClass]="{ attention: !loading && selectedNode }" (click)="loadPrev(selectedNode)"
            mat-button [disabled]="loading || !selectedNode" matTooltip="Load more content backward">
            <span *ngIf="loading == 'prev'; else upArrow">Loading...</span>
            <ng-template #upArrow><i class="material-icons">keyboard_arrow_up</i></ng-template>
          </button>
        </ng-template>

        <pre #output>{{currentOutput?.content}}</pre>

        <div class="control static down" *ngIf="currentOutput?.end; else nextButton">
          Output End
        </div>
        <ng-template #nextButton>
          <button class="control down" [ngClass]="{ attention: !loading && selectedNode }" (click)="loadNext(selectedNode)"
            mat-button [disabled]="loading || !selectedNode" matTooltip="Load more content forward">
            <span *ngIf="loading == 'next'; else downArrow">Loading...</span>
            <ng-template #downArrow><i class="material-icons">keyboard_arrow_down</i></ng-template>
          </button>
        </ng-template>

        <div class="control" *ngIf="loading">
          <mat-progress-bar mode="buffer"></mat-progress-bar>
        </div>

        <div class="control bottom">
          <a [href]="currentOutputUrl" *ngIf="currentOutputUrl">
            <i class="material-icons">file_download</i> Download the whole output
          </a>
          <mat-checkbox [disabled]="loading && loading != 'auto'" [checked]="autoload" (change)="toggleAutoload($event.checked)">Autoscroll</mat-checkbox>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<ng-template #waiting>
  <div class="waiting">
    <mat-spinner></mat-spinner>
    <p>
      Waiting...
    </p>
    <p>{{errorMsg}}</p>
  </div>
</ng-template>
